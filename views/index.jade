doctype html
html
    head
        meta(charset='utf-8')
        title Conecta 4
        link(rel='stylesheet', href='css/normalize.css')
        link(rel='stylesheet', href='css/foundation.css')
        link(rel='stylesheet', href='css/main.css')
        link(rel='stylesheet', href='http://fonts.googleapis.com/css?family=Lato:300,400')
    body

        .float.hide
            .row
                .content
                    h2
                    a(href="").expand.button Jugar de nuevo

        .row
            .large-12.columns
                h1.text-center Conecta 4
                
        
        .row.conecta
            .large-2.small-2.columns
                div(data-ficha= '0').ficha
            .large-2.small-2.columns
                div(data-ficha= '1').ficha
            .large-2.small-2.columns
                div(data-ficha= '2').ficha
            .large-2.small-2.columns
                div(data-ficha= '3').ficha
            .large-2.small-2.columns
                div(data-ficha= '4').ficha
            .large-2.small-2.columns
                div(data-ficha= '5').ficha

            .espacios
                .large-2.small-2.columns
                    .grid.fila-6.col-1                
                .large-2.small-2.columns
                    .grid.fila-6.col-2
                .large-2.small-2.columns
                    .grid.fila-6.col-3
                .large-2.small-2.columns
                    .grid.fila-6.col-4
                .large-2.small-2.columns
                    .grid.fila-6.col-5
                .large-2.small-2.columns
                    .grid.fila-6.col-6
                .large-2.small-2.columns
                    .grid.fila-5.col-1                
                .large-2.small-2.columns
                    .grid.fila-5.col-2
                .large-2.small-2.columns
                    .grid.fila-5.col-3
                .large-2.small-2.columns
                    .grid.fila-5.col-4
                .large-2.small-2.columns
                    .grid.fila-5.col-5
                .large-2.small-2.columns
                    .grid.fila-5.col-6
                .large-2.small-2.columns
                    .grid.fila-4.col-1
                .large-2.small-2.columns
                    .grid.fila-4.col-2
                .large-2.small-2.columns
                    .grid.fila-4.col-3
                .large-2.small-2.columns
                    .grid.fila-4.col-4
                .large-2.small-2.columns
                    .grid.fila-4.col-5
                .large-2.small-2.columns
                    .grid.fila-4.col-6
                .large-2.small-2.columns
                    .grid.fila-3.col-1
                .large-2.small-2.columns
                    .grid.fila-3.col-2
                .large-2.small-2.columns
                    .grid.fila-3.col-3
                .large-2.small-2.columns
                    .grid.fila-3.col-4
                .large-2.small-2.columns
                    .grid.fila-3.col-5
                .large-2.small-2.columns
                    .grid.fila-3.col-6
                .large-2.small-2.columns
                    .grid.fila-2.col-1
                .large-2.small-2.columns
                    .grid.fila-2.col-2
                .large-2.small-2.columns
                    .grid.fila-2.col-3
                .large-2.small-2.columns
                    .grid.fila-2.col-4
                .large-2.small-2.columns
                    .grid.fila-2.col-5
                .large-2.small-2.columns
                    .grid.fila-2.col-6
                .large-2.small-2.columns
                    .grid.fila-1.col-1
                .large-2.small-2.columns
                    .grid.fila-1.col-2
                .large-2.small-2.columns
                    .grid.fila-1.col-3
                .large-2.small-2.columns
                    .grid.fila-1.col-4
                .large-2.small-2.columns
                    .grid.fila-1.col-5
                .large-2.small-2.columns
                    .grid.fila-1.col-6
        
        .row.panel.usuario
            .large-8.small-8.columns
                button.hide.start.expand Iniciar
            .large-4.small-4.columns
                h3.text-right
                h5.text-right.subheader.turno.hide Tu turno
                h5.text-right.subheader.espera.hide Espera tu turno
                h6.text-right.mensajes

        script(src='/socket.io/socket.io.js')
        script(src='js/vendor/jquery.js')
        script(type='text/javascript').
            var playing = false
            $(document).ready(function(){
                var socket = io()
                

                socket.on('hi', function(user){
                    $('.usuario h3').html(user.user)
                    //limpiar clases
                    $('.conecta').removeClass('user-1')
                    $('.conecta').removeClass('user-2')
                    $('.conecta').addClass(user.clase)
                    $('.grid').removeClass('movimiento-1')
                    $('.grid').removeClass('movimiento-2')
                    //
                    $('.turno').addClass('hide')
                    $('.espera').addClass('hide')

                })

                socket.on('clean', function(){
                    
                    $('.grid').removeClass('movimiento-1')
                    $('.grid').removeClass('movimiento-2')
                })

                socket.on('bye', function(user){
                    playing = false
                    $('.mensajes').html(user.mensaje)
                })

                socket.on('start', function(){
                    $('.start').removeClass('hide')
                })

                socket.on('tu turno', function(){
                    playing = true
                    $('.turno').removeClass('hide')
                    $('.espera').addClass('hide')
                })

                socket.on('espera turno', function(){
                    $('.turno').addClass('hide')
                    $('.espera').removeClass('hide')
                })

                socket.on('movimiento', function(casilla){
                    //pintar casilla
                    $('.fila-'+casilla.fila+'.col-'+casilla.col).addClass('movimiento-'+casilla.user)
                })

                socket.on('resultado', function(end){
                    $('.float h2').html(end.resultado)
                    $('.float').removeClass('hide')
                })

                
                
                $('.start').click(function(){
                    socket.emit('start')
                    $('.turno').removeClass('hide')
                    $('.start').addClass('hide')
                })

                $('.ficha').click(function(){
                    if(playing){
                        var numFicha = $(this).data('ficha')
                        socket.emit('movimiento',  numFicha)
                    }
                })


            })
            

